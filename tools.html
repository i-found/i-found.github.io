
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>终极时间轴转换工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f0f2f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .main-container {
            width: 560px;
            max-width: 90%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            padding: 32px;
        }

        h1 {
            color: #2d3436;
            text-align: center;
            font-size: 24px;
            margin-bottom: 28px;
            font-weight: 600;
        }

        #editor {
            width: 100%;
            height: 200px;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            resize: vertical;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 24px;
            transition: border-color 0.2s;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .btn {
            padding: 12px 0;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        #convertBtn { background: #0984e3; color: white; }
        #copyBtn { background: #00b894; color: white; }

        @media (max-width: 600px) {
            .action-buttons { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>时间轴转SRT文本工具</h1>
        <textarea id="editor" placeholder="📋 请在此粘贴时间轴内容..."></textarea>
        <div class="action-buttons">
            <button id="convertBtn" class="btn">🚀 立即转换</button>
            <button id="copyBtn" class="btn">📋 复制结果</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editor = document.getElementById('editor');
            const convertBtn = document.getElementById('convertBtn');
            const copyBtn = document.getElementById('copyBtn');

            // 转换功能
            convertBtn.addEventListener('click', async () => {
                try {
                    let inputText = editor.value.trim();
                    if (!inputText) {
                        inputText = await navigator.clipboard.readText();
                    }
                    editor.value = convertToSRT(inputText);
                    editor.scrollTop = editor.scrollHeight;
                } catch (error) {
                    alert('操作失败，请检查内容格式');
                }
            });

            // 复制功能
            copyBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(editor.value);
                    alert('内容已复制到剪贴板');
                } catch (error) {
                    alert('请手动复制内容');
                }
            });
        });

        function convertToSRT(timeline) {
            const lines = timeline.split('\n')
                .map(line => line.trim())
                .filter(line => {
                    // 支持以下格式：
                    // HH:MM:SS 文本
                    // MM:SS 文本
                    // M:S 文本
                    return /^(\d{1,2}:){0,2}\d{1,2}:\d{2}\s+.+/.test(line);
                });

            if (lines.length === 0) return '错误：未检测到有效时间轴格式';

            let output = '';
            
            const parseTime = (timeStr) => {
                const parts = timeStr.split(':');
                // 自动补全时间格式
                while(parts.length < 3) parts.unshift('00');
                return {
                    h: parseInt(parts[0]),
                    m: parseInt(parts[1]),
                    s: parseInt(parts[2])
                };
            };

            const timeToSeconds = (timeStr) => {
                const {h, m, s} = parseTime(timeStr);
                return h * 3600 + m * 60 + s;
            };

            const formatSRTTime = (totalSeconds) => {
                const h = Math.floor(totalSeconds / 3600);
                const m = Math.floor((totalSeconds % 3600) / 60);
                const s = totalSeconds % 60;
                return [
                    h.toString().padStart(2, '0'),
                    m.toString().padStart(2, '0'),
                    s.toString().padStart(2, '0')
                ].join(':') + ',000';
            };

            lines.forEach((line, index) => {
                // 提取时间部分
                const timeMatch = line.match(/^(\d{1,2}:){0,2}\d{1,2}:\d{2}/);
                if (!timeMatch) return;
                
                const timePart = timeMatch[0];
                const content = line.slice(timePart.length).trim();
                const start = timeToSeconds(timePart);

                // 计算结束时间
                let end;
                if (index < lines.length - 1) {
                    const nextTime = lines[index+1].match(/^(\d{1,2}:){0,2}\d{1,2}:\d{2}/)[0];
                    end = timeToSeconds(nextTime);
                } else {
                    end = start + 180; // 最后一项+3分钟
                }

                output += `${index+1}\n` +
                         `${formatSRTTime(start)} --> ${formatSRTTime(end)}\n` +
                         `${content}\n\n`;
            });

            return output.trim();
        }
    </script>
</body>
</html>
