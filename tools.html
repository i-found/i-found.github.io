
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç»ˆææ—¶é—´è½´è½¬æ¢å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f0f2f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .main-container {
            width: 560px;
            max-width: 90%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            padding: 32px;
        }

        h1 {
            color: #2d3436;
            text-align: center;
            font-size: 24px;
            margin-bottom: 28px;
            font-weight: 600;
        }

        #editor {
            width: 100%;
            height: 200px;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            resize: vertical;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 24px;
            transition: border-color 0.2s;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .btn {
            padding: 12px 0;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        #convertBtn { background: #0984e3; color: white; }
        #copyBtn { background: #00b894; color: white; }

        @media (max-width: 600px) {
            .action-buttons { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>æ—¶é—´è½´è½¬SRTæ–‡æœ¬å·¥å…·</h1>
        <textarea id="editor" placeholder="ğŸ“‹ è¯·åœ¨æ­¤ç²˜è´´æ—¶é—´è½´å†…å®¹..."></textarea>
        <div class="action-buttons">
            <button id="convertBtn" class="btn">ğŸš€ ç«‹å³è½¬æ¢</button>
            <button id="copyBtn" class="btn">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editor = document.getElementById('editor');
            const convertBtn = document.getElementById('convertBtn');
            const copyBtn = document.getElementById('copyBtn');

            // è½¬æ¢åŠŸèƒ½
            convertBtn.addEventListener('click', async () => {
                try {
                    let inputText = editor.value.trim();
                    if (!inputText) {
                        inputText = await navigator.clipboard.readText();
                    }
                    editor.value = convertToSRT(inputText);
                    editor.scrollTop = editor.scrollHeight;
                } catch (error) {
                    alert('æ“ä½œå¤±è´¥ï¼Œè¯·æ£€æŸ¥å†…å®¹æ ¼å¼');
                }
            });

            // å¤åˆ¶åŠŸèƒ½
            copyBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(editor.value);
                    alert('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } catch (error) {
                    alert('è¯·æ‰‹åŠ¨å¤åˆ¶å†…å®¹');
                }
            });
        });

        function convertToSRT(timeline) {
            const lines = timeline.split('\n')
                .map(line => line.trim())
                .filter(line => {
                    // æ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š
                    // HH:MM:SS æ–‡æœ¬
                    // MM:SS æ–‡æœ¬
                    // M:S æ–‡æœ¬
                    return /^(\d{1,2}:){0,2}\d{1,2}:\d{2}\s+.+/.test(line);
                });

            if (lines.length === 0) return 'é”™è¯¯ï¼šæœªæ£€æµ‹åˆ°æœ‰æ•ˆæ—¶é—´è½´æ ¼å¼';

            let output = '';
            
            const parseTime = (timeStr) => {
                const parts = timeStr.split(':');
                // è‡ªåŠ¨è¡¥å…¨æ—¶é—´æ ¼å¼
                while(parts.length < 3) parts.unshift('00');
                return {
                    h: parseInt(parts[0]),
                    m: parseInt(parts[1]),
                    s: parseInt(parts[2])
                };
            };

            const timeToSeconds = (timeStr) => {
                const {h, m, s} = parseTime(timeStr);
                return h * 3600 + m * 60 + s;
            };

            const formatSRTTime = (totalSeconds) => {
                const h = Math.floor(totalSeconds / 3600);
                const m = Math.floor((totalSeconds % 3600) / 60);
                const s = totalSeconds % 60;
                return [
                    h.toString().padStart(2, '0'),
                    m.toString().padStart(2, '0'),
                    s.toString().padStart(2, '0')
                ].join(':') + ',000';
            };

            lines.forEach((line, index) => {
                // æå–æ—¶é—´éƒ¨åˆ†
                const timeMatch = line.match(/^(\d{1,2}:){0,2}\d{1,2}:\d{2}/);
                if (!timeMatch) return;
                
                const timePart = timeMatch[0];
                const content = line.slice(timePart.length).trim();
                const start = timeToSeconds(timePart);

                // è®¡ç®—ç»“æŸæ—¶é—´
                let end;
                if (index < lines.length - 1) {
                    const nextTime = lines[index+1].match(/^(\d{1,2}:){0,2}\d{1,2}:\d{2}/)[0];
                    end = timeToSeconds(nextTime);
                } else {
                    end = start + 180; // æœ€åä¸€é¡¹+3åˆ†é’Ÿ
                }

                output += `${index+1}\n` +
                         `${formatSRTTime(start)} --> ${formatSRTTime(end)}\n` +
                         `${content}\n\n`;
            });

            return output.trim();
        }
    </script>
</body>
</html>
